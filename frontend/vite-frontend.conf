<VirtualHost *:80>
    ServerName localhost
    DocumentRoot "/usr/local/apache2/htdocs"

    <Directory "/usr/local/apache2/htdocs">
        Options FollowSymLinks
        AllowOverride None
        Require all granted

        # SPA fallback: serve index.html for routes that aren't files/dirs
        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule ^ /index.html [L]
    </Directory>

    # Pass Authorization header through (for JWT Bearer from Apollo)
    Header unset Authorization
    RequestHeader set Authorization "expr=%{HTTP:Authorization}"

    # Reverse proxy GraphQL to the WordPress service on the Docker network
    ProxyPreserveHost On
    ProxyPass        /graphql http://wordpress/graphql
    ProxyPassReverse /graphql http://wordpress/graphql
</VirtualHost>
